<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng xếp hạng - QuấtWin</title>
    <link rel="stylesheet" href="../css/index.css">
    <style>
        :root {
            --primary: #4ecdc4;
            --secondary: #44a08d;
            --accent: #ff6b6b;
            --background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-strong: #ffffff;
            --text-soft: #e0e0e0;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            min-height: 100vh;
            color: var(--text-strong);
        }

        .leaderboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .leaderboard-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .leaderboard-subtitle {
            font-size: 1.2rem;
            color: var(--text-soft);
            margin-bottom: 30px;
        }

        .leaderboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-soft);
        }

        .leaderboard-table {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            padding: 20px;
            text-align: center;
        }

        .table-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
        }

        .table-content {
            padding: 0;
        }

        .player-row {
            display: grid;
            grid-template-columns: 60px 1fr 120px 120px 120px 120px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .player-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .player-row:last-child {
            border-bottom: none;
        }

        .rank {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }

        .rank-1 { color: #ffd700; }
        .rank-2 { color: #c0c0c0; }
        .rank-3 { color: #cd7f32; }
        .rank-other { color: var(--text-soft); }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .player-name {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .stat-value {
            text-align: center;
            font-weight: 500;
        }

        .balance {
            color: #4ecdc4;
        }

        .wins {
            color: #ff6b6b;
        }

        .games {
            color: #ffa726;
        }

        .profit {
            color: #66bb6a;
        }

        .table-header-row {
            display: grid;
            grid-template-columns: 60px 1fr 120px 120px 120px 120px;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            color: var(--text-soft);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--text-soft);
        }

        .error {
            text-align: center;
            padding: 40px;
            color: var(--accent);
            font-size: 1.1rem;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--text-soft);
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .leaderboard-container {
                padding: 10px;
            }

            .leaderboard-title {
                font-size: 2rem;
            }

            .player-row,
            .table-header-row {
                grid-template-columns: 40px 1fr 80px 80px 80px 80px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .player-avatar {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-number {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <img id="menuTriggerLogo" src="../stream/logo.png" alt="logo" />
    <nav class="sidebar-nav hidden">
        <div class="logo">
            <h1>QuấtWin</h1>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active">
                <a href="../index.html" class="nav-link" id="gameLink">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor"
                            d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z" />
                        <circle cx="5" cy="8" r="1" />
                        <circle cx="8" cy="8" r="1" />
                        <circle cx="11" cy="8" r="1" />
                    </svg>
                    <span>Trò chơi</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./stats.html" class="nav-link" id="statsLink">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor"
                            d="M0 0h16v16H0V0zm1 1v14h14V1H1zm2 2h10v1H3V3zm0 2h10v1H3V5zm0 2h7v1H3V7zm0 2h5v1H3V9z" />
                    </svg>
                    <span>Thống kê</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>
                        <path fill="currentColor" d="M8 2C4.69 2 2 4.69 2 8s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/>
                        <path fill="currentColor" d="M8 4c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                    </svg>
                    <span>Bảng xếp hạng</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="help.html" class="nav-link">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor"
                            d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                        <path fill="currentColor"
                            d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-1.01 1.16-.408.133-.958.304-1.01.832-.01.178.03.347.102.446a.25.25 0 0 0 .192.14h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.16.408-.133.958-.304 1.01-.832.01-.178-.03-.347-.102-.446a.25.25 0 0 0-.192-.14H6.5a.25.25 0 0 0-.25.25v.105c0 .718-.273.927-1.01 1.16-.408.133-.958.304-1.01.832-.01.178.03.347.102.446a.25.25 0 0 0 .192.14h.811a.25.25 0 0 0 .25-.25v-.105z" />
                    </svg>
                    <span>Trợ giúp</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" id="logoutLink">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor"
                            d="M6 12c0 .55.45 1 1 1s1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H8V2c0-.55-.45-1-1-1s-1 .45-1 1v3H4c-.55 0-1 .45-1 1s.45 1 1 1h2v5z" />
                    </svg>
                    <span>Đăng xuất</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="leaderboard-container">
        <div class="leaderboard-header">
            <h1 class="leaderboard-title">🏆 Bảng xếp hạng</h1>
            <p class="leaderboard-subtitle">Top những người chơi xuất sắc nhất</p>
        </div>

        <div class="leaderboard-stats" id="leaderboardStats">
            <div class="stat-card">
                <div class="stat-number" id="totalPlayers">-</div>
                <div class="stat-label">Tổng người chơi</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalGames">-</div>
                <div class="stat-label">Tổng ván chơi</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalWins">-</div>
                <div class="stat-label">Tổng lần thắng</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalBalance">-</div>
                <div class="stat-label">Tổng số dư</div>
            </div>
        </div>

        <div class="leaderboard-table">
            <div class="table-header">
                <h2 class="table-title">📊 Top người chơi</h2>
            </div>
            <div class="table-content">
                <div class="table-header-row">
                    <div>Hạng</div>
                    <div>Người chơi</div>
                    <div>Số dư</div>
                    <div>Thắng</div>
                    <div>Ván chơi</div>
                    <div>Lợi nhuận</div>
                </div>
                <div id="leaderboardList">
                    <div class="loading">Đang tải dữ liệu...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let token = localStorage.getItem('quatwin_token');

        // Check authentication
        if (!token) {
            window.location.href = '/login.html';
        }

        // Load leaderboard data
        async function loadLeaderboard() {
            try {
                const response = await fetch(`${API_BASE}/leaderboard`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    localStorage.removeItem('quatwin_token');
                    localStorage.removeItem('quatwin_user');
                    window.location.href = '/login.html';
                    return;
                }

                if (!response.ok) {
                    throw new Error('Failed to load leaderboard');
                }

                const data = await response.json();
                displayLeaderboard(data);
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('leaderboardList').innerHTML = 
                    '<div class="error">Lỗi tải dữ liệu. Vui lòng thử lại.</div>';
            }
        }

        function displayLeaderboard(data) {
            // Update stats
            document.getElementById('totalPlayers').textContent = data.totalPlayers || 0;
            document.getElementById('totalGames').textContent = (data.totalGames || 0).toLocaleString();
            document.getElementById('totalWins').textContent = (data.totalWins || 0).toLocaleString();
            document.getElementById('totalBalance').textContent = formatCurrency(data.totalBalance || 0);

            // Display leaderboard
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (!data.players || data.players.length === 0) {
                leaderboardList.innerHTML = '<div class="no-data">Chưa có dữ liệu người chơi</div>';
                return;
            }

            leaderboardList.innerHTML = data.players.map((player, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                const avatar = player.username.charAt(0).toUpperCase();
                const winRate = player.totalGames > 0 ? ((player.totalWins / player.totalGames) * 100).toFixed(1) : 0;

                return `
                    <div class="player-row">
                        <div class="rank ${rankClass}">${rank}</div>
                        <div class="player-info">
                            <div class="player-avatar">${avatar}</div>
                            <div class="player-name">${player.username}</div>
                        </div>
                        <div class="stat-value balance">${formatCurrency(player.balance)}</div>
                        <div class="stat-value wins">${player.totalWins}</div>
                        <div class="stat-value games">${player.totalGames}</div>
                        <div class="stat-value profit">${formatCurrency(player.totalProfit)}</div>
                    </div>
                `;
            }).join('');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // Logout functionality
        function showLogoutConfirm() {
            const popup = document.createElement('div');
            popup.className = 'logout-popup';
            popup.innerHTML = `
                <div class="logout-content">
                    <div class="logout-title">🚪 Đăng xuất</div>
                    <div class="logout-message">Bạn có chắc muốn đăng xuất?</div>
                    <div class="logout-buttons">
                        <button class="logout-cancel">Hủy</button>
                        <button class="logout-confirm">Đăng xuất</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            popup.querySelector('.logout-cancel').addEventListener('click', () => {
                document.body.removeChild(popup);
            });
            
            popup.querySelector('.logout-confirm').addEventListener('click', () => {
                localStorage.removeItem('quatwin_token');
                localStorage.removeItem('quatwin_user');
                window.location.href = '/login.html';
            });
            
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    document.body.removeChild(popup);
                }
            });
        }

        // Event listeners
        document.getElementById('logoutLink').addEventListener('click', (e) => {
            e.preventDefault();
            showLogoutConfirm();
        });

        // Sidebar toggle functionality
        const sidebar = document.querySelector('.sidebar-nav');
        const triggerImg = document.getElementById('menuTriggerLogo');
        
        if (triggerImg) {
            triggerImg.addEventListener('click', () => {
                if (sidebar?.classList.contains('hidden')) {
                    sidebar.classList.remove('hidden');
                } else {
                    sidebar.classList.add('hidden');
                }
            });
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadLeaderboard);
    </script>
</body>
</html>
